<!DOCTYPE html>
<html lang="lt">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Crypto Tracker v3.9.7</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = { darkMode: 'class', theme: { extend: { colors: { gray: { 850: '#1f2937', 900: '#111827', 950: '#0b0f19' }, primary: { 400: '#2dd4bf', 500: '#14b8a6', 600: '#0d9488' } } } } }
    </script>
    <script>
        if (localStorage.theme === 'dark' || (!('theme' in localStorage) && window.matchMedia('(prefers-color-scheme: dark)').matches)) { document.documentElement.classList.add('dark'); } else { document.documentElement.classList.remove('dark'); }
    </script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        body { -webkit-tap-highlight-color: transparent; } input, select, textarea { -webkit-appearance: none; -moz-appearance: none; } .no-scrollbar::-webkit-scrollbar { display: none; } .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; } .fade-in { animation: fadeIn 0.5s ease-in-out; } @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } } .animate-slide-up { animation: slideUp 0.3s ease-out; } @keyframes slideUp { from { transform: translateY(100%); } to { transform: translateY(0); } } .pop-in { animation: popIn 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275) forwards; } @keyframes popIn { 0% { transform: scale(0.5); opacity: 0; } 100% { transform: scale(1); opacity: 1; } } .spinner { border: 2px solid rgba(156, 163, 175, 0.3); border-top-color: #2dd4bf; border-radius: 50%; width: 20px; height: 20px; animation: spin 0.8s linear infinite; } @keyframes spin { to { transform: rotate(360deg); } } .form-checkbox { appearance: none; background-color: #f3f4f6; border: 1px solid #d1d5db; display: inline-block; position: relative; } .dark .form-checkbox { background-color: #1f2937; border-color: #374151; } .form-checkbox:checked { background-color: #2dd4bf; border-color: #2dd4bf; } .form-checkbox:checked:after { content: '‚úî'; position: absolute; top: -2px; left: 1px; font-size: 10px; color: #000; } .toast { position: fixed; bottom: 20px; right: 20px; z-index: 9999; transform: translateX(400px); transition: transform 0.3s ease-out; } .toast.show { transform: translateX(0); }
    </style>
</head>
<body class="bg-gray-100 text-gray-800 dark:bg-gray-950 dark:text-gray-200 font-sans pb-20 transition-colors duration-300">
    <input type="file" id="csv-file-input" accept=".csv" class="hidden">
    <div id="toast-container"></div>

    <div id="app-content"> 
        <header class="fixed top-0 w-full bg-white/95 dark:bg-gray-900/95 backdrop-blur z-40 transition-colors duration-300 pb-2">
            <div class="max-w-md mx-auto px-4 pt-4">
                <div class="flex justify-between items-center mb-6">
                    <div class="flex items-center gap-2">
                        <div class="w-8 h-8 bg-primary-500/10 rounded-full flex items-center justify-center"><i class="fa-solid fa-wallet text-primary-500"></i></div>
                        <h1 class="font-bold text-lg text-gray-900 dark:text-white">Portfelis</h1>
                    </div>
                    <div class="flex items-center gap-3">
                        <button type="button" id="btn-settings" onclick="document.getElementById('settings-modal').classList.remove('hidden')" class="w-8 h-8 flex items-center justify-center rounded-full bg-gray-100 dark:bg-gray-800 text-gray-500 hover:text-gray-900 dark:hover:text-white transition-colors"><i class="fa-solid fa-gear"></i></button>
                    </div>
                </div>
                <div class="text-center mb-6">
                    <p class="text-xs text-gray-500 font-medium uppercase tracking-wider mb-1">Bendra vertƒó</p>
                    <h1 id="header-total-value" class="text-5xl font-bold text-gray-900 dark:text-white tracking-tight">$0.00</h1>
                </div>
                <div class="grid grid-cols-3 gap-2 mb-2">
                    <div class="bg-gray-50 dark:bg-gray-800/50 rounded-xl p-2 text-center border border-gray-100 dark:border-gray-800"><p class="text-[9px] text-gray-500 uppercase font-bold mb-1">24H</p><p id="header-24h-change" class="text-xs font-bold text-gray-400">...</p></div>
                    <div class="bg-gray-50 dark:bg-gray-800/50 rounded-xl p-2 text-center border border-gray-100 dark:border-gray-800"><p class="text-[9px] text-gray-500 uppercase font-bold mb-1">30D</p><p id="header-30d-change" class="text-xs font-bold text-gray-400">...</p></div>
                    <div class="bg-gray-50 dark:bg-gray-800/50 rounded-xl p-2 text-center border border-gray-100 dark:border-gray-800"><p class="text-[9px] text-gray-500 uppercase font-bold mb-1">Total PnL</p><p id="header-total-pnl" class="text-xs font-bold text-gray-400">...</p></div>
                </div>
            </div>
        </header>

        <main class="max-w-md mx-auto px-4 pt-[280px] space-y-5 min-h-screen pb-20">
            <section class="grid grid-cols-1 gap-4">
                <div class="bg-white dark:bg-gray-900 rounded-2xl border border-gray-200 dark:border-gray-800 p-4 shadow-lg relative overflow-hidden transition-colors duration-300">
                    <div class="flex justify-between items-center mb-4"><span class="text-xs font-bold text-gray-500 uppercase">Istorija</span><div id="tf-indicator" class="bg-primary-500/10 text-primary-600 dark:text-primary-400 px-2 py-0.5 rounded text-[10px] font-bold">ALL</div></div>
                    <div class="h-48 w-full mb-4"><canvas id="pnlChart"></canvas></div>
                    <div class="flex justify-between items-center px-1 bg-gray-100 dark:bg-gray-800/50 p-1 rounded-xl gap-0.5">
                        <button onclick="window.changePnLTimeframe('24H')" class="tf-btn flex-1 text-[10px] font-bold text-gray-400 py-1 rounded">24H</button>
                        <button onclick="window.changePnLTimeframe('1W')" class="tf-btn flex-1 text-[10px] font-bold text-gray-400 py-1 rounded">1W</button>
                        <button onclick="window.changePnLTimeframe('1M')" class="tf-btn flex-1 text-[10px] font-bold text-gray-400 py-1 rounded">1M</button>
                        <button onclick="window.changePnLTimeframe('3M')" class="tf-btn flex-1 text-[10px] font-bold text-gray-400 py-1 rounded">3M</button>
                        <button onclick="window.changePnLTimeframe('6M')" class="tf-btn flex-1 text-[10px] font-bold text-gray-400 py-1 rounded">6M</button>
                        <button onclick="window.changePnLTimeframe('1Y')" class="tf-btn flex-1 text-[10px] font-bold text-gray-400 py-1 rounded">1Y</button>
                        <button onclick="window.changePnLTimeframe('ALL')" class="tf-btn flex-1 text-[10px] font-bold text-white bg-gray-800 dark:bg-gray-600 py-1 rounded">ALL</button>
                    </div>
                </div>
            </section>
            <section><h3 class="text-gray-500 text-xs uppercase font-bold ml-1 mb-2">Turto Paskirstymas</h3><div class="bg-white dark:bg-gray-900 rounded-2xl border border-gray-200 dark:border-gray-800 p-4 shadow-lg"><div style="max-height: 250px; position: relative;"><canvas id="allocationChart"></canvas></div></div></section>
            <section><h3 class="text-gray-500 text-xs uppercase font-bold ml-1 mb-2">Turimas Turtas</h3><div id="coin-cards-container" class="grid grid-cols-1 gap-3"></div></section>
            <section id="goals-section" class="hidden"><h3 class="text-gray-500 text-xs uppercase font-bold ml-1 mb-2">Tiksl≈≥ Progresas</h3><div id="goals-container" class="space-y-3"></div></section>
            <section class="grid grid-cols-2 gap-3">
                <button onclick="document.getElementById('add-modal').classList.remove('hidden')" class="bg-primary-600 hover:bg-primary-500 text-white font-bold py-3.5 rounded-xl shadow-lg flex items-center justify-center gap-2"><i class="fa-solid fa-plus"></i> Pridƒóti</button>
                <button onclick="document.getElementById('csv-file-input').click()" class="bg-white dark:bg-gray-800 text-gray-700 dark:text-white font-bold py-3.5 rounded-xl border border-gray-200 dark:border-gray-700 flex items-center justify-center gap-2"><i class="fa-solid fa-file-import"></i> CSV Importas</button>
            </section>
            <section><div class="flex justify-between items-end mb-2 px-1"><h3 class="text-gray-500 text-xs uppercase font-bold">Istorija</h3><div class="flex gap-2"><button id="btn-delete-selected" class="hidden text-[10px] text-red-500 bg-red-100 px-2 py-1 rounded border border-red-200"><i class="fa-solid fa-trash"></i> Trinti (<span id="selected-count">0</span>)</button></div></div><div id="journal-accordion" class="space-y-3"><div class="px-4 py-8 text-center text-xs text-gray-600"><div class="spinner mx-auto mb-2"></div>Kraunama...</div></div></section>
            <section class="text-center pt-4 border-t border-gray-200 dark:border-gray-800 mt-6"><div class="flex justify-center gap-4"><button onclick="document.getElementById('new-coin-modal').classList.remove('hidden')" class="text-xs text-primary-600 dark:text-primary-400 underline decoration-gray-300 dark:decoration-gray-700 underline-offset-4">Pridƒóti MonetƒÖ</button><button onclick="document.getElementById('delete-coin-modal').classList.remove('hidden')" class="text-xs text-red-500 dark:text-red-400 underline decoration-gray-300 dark:decoration-gray-700 underline-offset-4">I≈°trinti MonetƒÖ</button></div></section>
            <footer class="mt-10 py-8 text-center space-y-1 opacity-70"><p class="text-[11px] text-gray-500">Sukurta su <i class="fa-solid fa-heart text-red-500 mx-0.5 animate-pulse"></i></p><p class="text-[9px] font-mono text-gray-700 pt-1">Versija <span id="app-version">v3.9.7</span></p></footer>
        </main>
    </div>

    <div id="add-modal" class="hidden fixed inset-0 bg-black/50 dark:bg-black/80 z-50 flex items-end sm:items-center justify-center backdrop-blur-sm">
        <div class="bg-white dark:bg-gray-900 w-full sm:max-w-md sm:rounded-2xl rounded-t-2xl border-t sm:border border-gray-200 dark:border-gray-800 p-5 space-y-5 animate-slide-up sm:animate-none max-h-[90vh] overflow-y-auto">
            <div class="flex justify-between items-center"><h3 class="font-bold text-lg text-gray-900 dark:text-white" id="modal-title">Nauja Transakcija</h3><button onclick="document.getElementById('add-modal').classList.add('hidden')" class="w-8 h-8 flex items-center justify-center rounded-full bg-gray-100 dark:bg-gray-800 text-gray-400"><i class="fa-solid fa-xmark"></i></button></div>
            <form id="add-tx-form" class="space-y-4">
                <input type="hidden" id="tx-id">
                <div class="grid grid-cols-2 gap-3">
                    <select id="tx-type" class="w-full bg-gray-50 dark:bg-gray-800 border border-gray-300 dark:border-gray-700 text-gray-900 dark:text-white text-sm rounded-xl p-3 font-bold"><option value="Buy">Buy üü¢</option><option value="Sell">Sell üî¥</option></select>
                    <div class="relative"><select id="tx-coin" class="w-full bg-gray-50 dark:bg-gray-800 border border-gray-300 dark:border-gray-700 text-gray-900 dark:text-white text-sm rounded-xl p-3 font-bold"></select></div>
                </div>
                <div class="grid grid-cols-2 gap-3">
                    <div class="relative"><label class="absolute -top-2 left-2 px-1 bg-white dark:bg-gray-900 text-[9px] text-gray-500 font-bold uppercase">Data</label><input type="date" id="tx-date-input" required class="w-full bg-gray-50 dark:bg-gray-800 border border-gray-300 dark:border-gray-700 text-gray-900 dark:text-white text-sm rounded-xl p-3"></div>
                    <div class="relative"><label class="absolute -top-2 left-2 px-1 bg-white dark:bg-gray-900 text-[9px] text-gray-500 font-bold uppercase">Laikas</label><input type="time" id="tx-time-input" class="w-full bg-gray-50 dark:bg-gray-800 border border-gray-300 dark:border-gray-700 text-gray-900 dark:text-white text-sm rounded-xl p-3"></div>
                </div>
                <div class="grid grid-cols-2 gap-3">
                     <div class="relative"><select id="tx-exchange" class="w-full bg-gray-50 dark:bg-gray-800 border border-gray-300 dark:border-gray-700 text-gray-900 dark:text-white text-sm rounded-xl p-3 font-bold"><option value="">Bir≈æa...</option><option value="Binance">Binance</option><option value="Bybit">Bybit</option><option value="Coinbase">Coinbase</option><option value="Kraken">Kraken</option><option value="KuCoin">KuCoin</option><option value="MEXC">MEXC</option><option value="Nexo">Nexo</option><option value="DeFi">DeFi / Wallet</option></select></div>
                    <div class="relative"><select id="tx-method" class="w-full bg-gray-50 dark:bg-gray-800 border border-gray-300 dark:border-gray-700 text-gray-900 dark:text-white text-sm rounded-xl p-3"><option value="Market Buy">Market Buy</option><option value="Limit Buy">Limit Buy</option><option value="Recurring Buy">Recurring Buy</option><option value="Gift/Airdrop">Gift / Airdrop</option></select></div>
                </div>
                
                <div class="bg-gray-50 dark:bg-gray-800/50 p-3 rounded-xl border border-gray-200 dark:border-gray-700/50 space-y-3">
                    <div class="grid grid-cols-2 gap-3">
                        <div><label class="text-[10px] text-gray-500 uppercase font-bold ml-1">Kiekis</label><input type="number" id="tx-amount" step="any" placeholder="0.00" inputmode="decimal" required class="w-full bg-white dark:bg-gray-900 border border-gray-300 dark:border-gray-700 text-gray-900 dark:text-white rounded-lg p-2"></div>
                        <div><label class="text-[10px] text-gray-500 uppercase font-bold ml-1 flex justify-between">Kaina ($) <span id="btn-fetch-price" class="text-primary-600 dark:text-primary-400 cursor-pointer">GAUTI</span></label><input type="number" id="tx-price" step="any" placeholder="0.00" inputmode="decimal" class="w-full bg-white dark:bg-gray-900 border border-gray-300 dark:border-gray-700 text-gray-900 dark:text-white rounded-lg p-2"></div>
                    </div>
                    <div class="grid grid-cols-2 gap-3">
                        <div><label class="text-[10px] text-gray-500 uppercase font-bold ml-1">Mokesƒçiai ($)</label><input type="number" id="tx-fees" step="any" placeholder="0.00" inputmode="decimal" class="w-full bg-white dark:bg-gray-900 border border-gray-300 dark:border-gray-700 text-red-500 font-bold rounded-lg p-2"></div>
                        <div><label class="text-[10px] text-gray-500 uppercase font-bold ml-1">Viso ($)</label><input type="number" id="tx-total" step="any" placeholder="0.00" inputmode="decimal" class="w-full bg-white dark:bg-gray-900 border border-primary-500/50 text-gray-900 dark:text-white font-bold rounded-lg p-2"></div>
                    </div>
                </div>

                <div><label class="text-[10px] text-gray-500 uppercase font-bold ml-1">Pastabos</label><textarea id="tx-notes" rows="2" class="w-full bg-gray-50 dark:bg-gray-800 border border-gray-300 dark:border-gray-700 text-gray-900 dark:text-white text-sm rounded-xl p-3"></textarea></div>
                <button type="submit" id="btn-save" class="w-full bg-primary-600 hover:bg-primary-500 text-white font-bold py-3.5 rounded-xl shadow-lg">I≈°saugoti</button>
            </form>
        </div>
    </div>

    <div id="settings-modal" class="hidden fixed inset-0 bg-black/50 z-50 flex items-center justify-center p-4"><div class="bg-white dark:bg-gray-900 w-full max-w-md rounded-2xl p-6"><div class="flex justify-between"><h3 class="font-bold text-gray-900 dark:text-white">Nustatymai</h3><button onclick="document.getElementById('settings-modal').classList.add('hidden')">X</button></div><div class="mt-4"><button id="btn-toggle-theme" class="bg-gray-200 px-4 py-2 rounded">Keisti temƒÖ</button></div></div></div>
    <div id="new-coin-modal" class="hidden fixed inset-0 bg-black/50 z-50 flex items-center justify-center p-4"><div class="bg-white dark:bg-gray-900 w-full max-w-sm rounded-2xl p-5 space-y-4"><h3 class="font-bold text-gray-900 dark:text-white">Pridƒóti MonetƒÖ</h3><input type="text" id="new-coin-symbol" placeholder="Simbolis" class="w-full border p-2 rounded"><input type="text" id="new-coin-id" placeholder="ID" class="w-full border p-2 rounded"><input type="number" id="new-coin-target" placeholder="Tikslas" class="w-full border p-2 rounded"><div class="flex gap-2"><button onclick="document.getElementById('new-coin-modal').classList.add('hidden')" class="flex-1 bg-gray-200 p-2 rounded">At≈°aukti</button><button id="btn-save-coin" class="flex-1 bg-primary-600 text-white p-2 rounded">Pridƒóti</button></div></div></div>
    <div id="delete-coin-modal" class="hidden fixed inset-0 bg-black/50 z-50 flex items-center justify-center p-4"><div class="bg-white dark:bg-gray-900 w-full max-w-sm rounded-2xl p-5 space-y-4"><h3 class="font-bold text-red-500">I≈°trinti MonetƒÖ</h3><select id="delete-coin-select" class="w-full border p-2 rounded"></select><div class="flex gap-2"><button onclick="document.getElementById('delete-coin-modal').classList.add('hidden')" class="flex-1 bg-gray-200 p-2 rounded">At≈°aukti</button><button id="btn-delete-coin" class="flex-1 bg-red-600 text-white p-2 rounded">I≈°trinti</button></div></div></div>
    <div id="edit-goal-modal" class="hidden fixed inset-0 bg-black/50 z-50 flex items-center justify-center p-4"><div class="bg-white dark:bg-gray-900 w-full max-w-sm rounded-2xl p-5 space-y-4"><h3 class="font-bold">Redaguoti TikslƒÖ</h3><input type="hidden" id="edit-goal-id"><p id="edit-goal-coin"></p><input type="number" id="edit-goal-target" class="w-full border p-2 rounded"><div class="flex gap-2"><button onclick="document.getElementById('edit-goal-modal').classList.add('hidden')" class="flex-1 bg-gray-200 p-2 rounded">At≈°aukti</button><button id="btn-update-goal" class="flex-1 bg-primary-600 text-white p-2 rounded">Atnaujinti</button><button id="btn-delete-goal" class="bg-red-600 text-white p-2 rounded">Trinti</button></div></div></div>
    <div id="celebration-modal" class="hidden fixed inset-0 z-50 flex items-center justify-center bg-black/90"><div class="text-center text-white p-10"><h2 class="text-4xl font-bold">Sveikiname! üèÜ</h2><p class="mt-4">Pasiekƒóte tikslƒÖ!</p><button onclick="document.getElementById('celebration-modal').classList.add('hidden')" class="mt-6 bg-primary-600 px-6 py-2 rounded">Valio!</button></div></div>

    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="js/supabase.js"></script>
    <script type="module" src="js/app.js"></script>
    <script>
        document.addEventListener('keydown', (e) => { if (e.key === 'Escape') document.querySelectorAll('[id$="-modal"]').forEach(m => m.classList.add('hidden')); });
    </script>
</body>
</html>
